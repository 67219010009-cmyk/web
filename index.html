<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">

<title>Losty | ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏ô</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<style>
body{background:#f4f6f9}
.card-img-top{height:180px;object-fit:cover}
.hidden{display:none}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="container mt-5" id="loginPage">
<div class="row justify-content-center">
<div class="col-md-4">
<div class="card shadow">
<div class="card-body">
<h4 class="text-center mb-3">üîê Losty</h4>
<input id="email" class="form-control mb-2" placeholder="Admin Email">
<input id="password" type="password" class="form-control mb-3" placeholder="Password">
<button class="btn btn-primary w-100 mb-2" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
<button class="btn btn-secondary w-100" onclick="guest()">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°</button>
</div>
</div>
</div>
</div>
</div>

<!-- APP -->
<div class="container my-4 hidden" id="appPage">

<div class="d-flex justify-content-between align-items-center mb-3">
<h4>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏ô</h4>
<div>
<span id="adminName" class="me-3 fw-bold text-primary"></span>
<button class="btn btn-danger btn-sm" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>
</div>

<!-- FORM -->
<div class="card mb-3" id="formCard">
<div class="card-header bg-primary text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö</div>
<div class="card-body row g-2">
<input id="type" class="form-control col-md-6" placeholder="‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö">
<input type="file" id="image" class="form-control col-md-6">
<input id="place" class="form-control col-md-6" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö">
<input id="finder" class="form-control col-md-6" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏ö">
<input id="finderId" class="form-control col-md-6" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
<button class="btn btn-success w-100" onclick="saveItem()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>
</div>

<!-- ADMIN TOOLS -->
<div class="mb-3" id="adminTools">
<button class="btn btn-info" onclick="openAllData()">üìÑ ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<div class="row" id="list"></div>
</div>

<!-- DETAIL MODAL -->
<div class="modal fade" id="detailModal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5>üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body" id="detailBody"></div>
</div>
</div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header"><h5>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5></div>
<div class="modal-body">
<input id="editType" class="form-control mb-2">
<input id="editPlace" class="form-control mb-2">
<input id="editFinder" class="form-control">
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
<button class="btn btn-warning" onclick="saveEdit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>
</div>
</div>
</div>

<!-- RECEIVE MODAL -->
<div class="modal fade" id="receiveModal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header"><h5>‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á</h5></div>
<div class="modal-body">
<input id="recvName" class="form-control mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô">
<input id="recvStdId" class="form-control mb-2" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
<input id="recvDate" type="datetime-local" class="form-control">
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
<button class="btn btn-success" onclick="confirmReceive()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
</div>
</div>
</div>
</div>

<!-- ALL DATA MODAL -->
<div class="modal fade" id="allDataModal">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<table class="table table-bordered">
<thead class="table-dark">
<tr>
<th>‡∏Ç‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ú‡∏π‡πâ‡∏û‡∏ö</th><th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
</tr>
</thead>
<tbody id="allDataTable"></tbody>
</table>
</div>
</div>
</div>
</div>

<script>
// üî• Firebase
firebase.initializeApp({
 apiKey: "AIzaSyCc0B8ceupztQKU14M7EuRATHjXJh-vK6I",
 authDomain: "losty-aa219.firebaseapp.com",
 projectId: "losty-aa219"
});
const auth = firebase.auth();

let isGuest=false, editId=null, recvItemId=null;
let items=JSON.parse(localStorage.getItem("lostItems"))||[];

auth.onAuthStateChanged(user=>{
 if(user){
  isGuest=false;
  openApp();
  adminName.innerText=user.email;
 }
});

function login(){auth.signInWithEmailAndPassword(email.value,password.value)}
function guest(){isGuest=true;openApp()}
function logout(){auth.signOut();location.reload()}

function openApp(){
 loginPage.classList.add("hidden");
 appPage.classList.remove("hidden");
 if(isGuest){
  formCard.classList.add("hidden");
  adminTools.classList.add("hidden");
  adminName.innerText="‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°";
 }
 showItems();
}

function saveItem(){
 const r=new FileReader();
 r.onload=()=>{
  items.push({
   id:Date.now(),
   type:type.value,
   image:r.result,
   place:place.value,
   finder:finder.value,
   finderId:finderId.value,
   status:"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô"
  });
  localStorage.setItem("lostItems",JSON.stringify(items));
  showItems();
 }
 r.readAsDataURL(image.files[0]);
}

function openDetail(id){
 const i=items.find(x=>x.id===id);
 let html=`
 <img src="${i.image}" class="img-fluid rounded mb-2">
 <p><b>‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡∏≠‡∏á:</b> ${i.type}</p>
 <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö:</b> ${i.place}</p>
 <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${i.status}</p>`;
 if(!isGuest){
  html+=`
  <hr>
  <p><b>‡∏ú‡∏π‡πâ‡∏û‡∏ö:</b> ${i.finder}</p>
  <p><b>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏û‡∏ö:</b> ${i.finderId}</p>
  <p><b>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô:</b> ${i.receiver||"-"}</p>
  <p><b>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô:</b> ${i.receiverId||"-"}</p>
  <p><b>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô:</b> ${i.receiveDate||"-"}</p>`;
 }
 detailBody.innerHTML=html;
 new bootstrap.Modal(detailModal).show();
}

function openEdit(id){
 editId=id;
 const i=items.find(x=>x.id===id);
 editType.value=i.type;
 editPlace.value=i.place;
 editFinder.value=i.finder;
 new bootstrap.Modal(editModal).show();
}

function saveEdit(){
 const i=items.find(x=>x.id===editId);
 i.type=editType.value;
 i.place=editPlace.value;
 i.finder=editFinder.value;
 localStorage.setItem("lostItems",JSON.stringify(items));
 bootstrap.Modal.getInstance(editModal).hide();
 showItems();
}

function openReceive(id){
 recvItemId=id;
 recvDate.value=new Date().toISOString().slice(0,16);
 new bootstrap.Modal(receiveModal).show();
}

function confirmReceive(){
 const i=items.find(x=>x.id===recvItemId);
 i.status="‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
 i.receiver=recvName.value;
 i.receiverId=recvStdId.value;
 i.receiveDate=recvDate.value;
 localStorage.setItem("lostItems",JSON.stringify(items));
 bootstrap.Modal.getInstance(receiveModal).hide();
 showItems();
}

function deleteItem(id){
 if(confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?")){
 items=items.filter(i=>i.id!==id);
 localStorage.setItem("lostItems",JSON.stringify(items));
 showItems();
 }
}

function openAllData(){
 let html="";
 items.forEach(i=>{
 html+=`
 <tr>
 <td>${i.type}</td>
 <td>${i.place}</td>
 <td>${i.finder||"-"}</td>
 <td>${i.receiver||"-"}</td>
 <td>${i.receiveDate||"-"}</td>
 </tr>`;
 });
 allDataTable.innerHTML=html;
 new bootstrap.Modal(allDataModal).show();
}

function showItems(){
 list.innerHTML="";
 items.forEach(i=>{
 list.innerHTML+=`
 <div class="col-md-4 mb-3">
 <div class="card">
 <img src="${i.image}" class="card-img-top">
 <div class="card-body">
 <span class="badge ${i.status=='‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß'?'bg-success':'bg-warning'}">${i.status}</span>
 <h5>${i.type}</h5>
 <p>${i.place}</p>
 <button class="btn btn-sm btn-info mb-1" onclick="openDetail(${i.id})">üîç ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
 ${!isGuest?`
 <br>
 <button class="btn btn-sm btn-success" onclick="openReceive(${i.id})">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</button>
 <button class="btn btn-sm btn-warning" onclick="openEdit(${i.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
 <button class="btn btn-sm btn-danger" onclick="deleteItem(${i.id})">‡∏•‡∏ö</button>`:""}
 </div>
 </div>
 </div>`;
 });
}
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
